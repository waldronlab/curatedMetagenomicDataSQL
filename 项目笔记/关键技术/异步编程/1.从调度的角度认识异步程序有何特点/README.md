# 为什么会产生异步编程

主要原因是I/O慢，处理快。典型情况就是：只有接收到必要的数据之后才可能进行下一步处理。

收到的数据不够，下一步的处理无法开展。

# 异步编程接口的形式(回调)

最典型的异步编程接口就是回调，这也是最早期的接口形式。

```javascript
//1.以下是提供出来的AIP
function recieveData(callback);
//2.使用者必须提供回调函数来接收数据,回调函数的典型形式是
function atferRecieve(error,data);
//如果error是0，则没有出错。收到的数据会放入到data中。
//如果error不是0,则表示接收过程出了错。数据不可用。
```

## 演示程序

```typescript
type callback = (error, data,id) => void;

//这是别人提供的一个API,需要回调来接收数据
function recieveData(cb: callback,id) {
    setTimeout(() => {
        if (Math.random() > 0.3) {
            cb(0, Math.random().toString(),id);
        } else {
            cb(1, "连接断开",id);
        }
    }, Math.random()*2000);
};

function afterRecieve(error, data,id): void {
    console.log("收到了第"+id+"次请求的响应");
    if (error) {
        console.log("接收数据失败,原因为：" + data);
    } else {
        console.log("成功收到数据:" + data);
    }
}

for (var i: number = 1; i < 10; i++) {
    //发起第i次接收
    recieveData(afterRecieve,i);
    console.log("发起了第"+i+"次接收");
}

```

## 程序的执行结果

```bash
发起了第1次接收
发起了第2次接收
发起了第3次接收
发起了第4次接收
发起了第5次接收
发起了第6次接收
发起了第7次接收
发起了第8次接收
发起了第9次接收
收到了第7次请求的响应
成功收到数据:0.6246517850954361
收到了第9次请求的响应
成功收到数据:0.2357361057492917
收到了第3次请求的响应
成功收到数据:0.502853539994355
收到了第8次请求的响应
成功收到数据:0.1433593004681748
收到了第1次请求的响应
成功收到数据:0.12431847163755672
收到了第6次请求的响应
成功收到数据:0.4941365821402901
收到了第5次请求的响应
成功收到数据:0.5101125855930813
收到了第2次请求的响应
接收数据失败,原因为：连接断开
收到了第4次请求的响应
成功收到数据:0.13137717825502948

Process finished with exit code 0
```

## 结论

### 异步程序的特点之一：后发可能先至

后发出的请求，可能先得到响应。

### 异步程序的特点之一：先发可能后至

先发起，后响应。

### 异步编程的特点和难点

需要编写很多回调函数，要控制回调函数的执行先后顺序就是一个难点。

# 第一个重要结论

所有允许我们在调用时提供回调函数的API，都是异步执行的。

也就是说，这个函数会马上返回。

# 提出问题/难点

比如：

①删除原来的文件；

②创建一个新文件；

③向新文件中写入数据。

如果这三个操作都是异步执行的，那么就会麻烦。

